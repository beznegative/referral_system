# üõ°Ô∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É –∫–∞–ø—á–∏

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–î–ª—è –æ–±—ã—á–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `captcha.php?target=miniapp`
   - –ü–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É "–Ø –Ω–µ —Ä–æ–±–æ—Ç"
   - –ù–∞–∂–º–∏—Ç–µ "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
   - –í—ã –ø–æ–ø–∞–¥–µ—Ç–µ –Ω–∞ `miniapp.php`

2. **–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ `captcha.php?target=test`
   - –ü—Ä–æ–π–¥–∏—Ç–µ –∫–∞–ø—á—É
   - –í—ã –ø–æ–ø–∞–¥–µ—Ç–µ –Ω–∞ `test_miniapp.php`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã

**–û—Ç–∫—Ä–æ–π—Ç–µ `test_captcha_system.php`** - —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å –∫–∞–ø—á–∏
- üîß –ö–Ω–æ–ø–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- üìä –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–µ—Å—Å–∏–∏
- üß™ –¢–µ—Å—Ç API –∑–∞–ø—Ä–æ—Å–æ–≤
- üìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –ª–æ–≥–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
üìÅ –§–∞–π–ª—ã –∫–∞–ø—á–∏:
‚îú‚îÄ‚îÄ captcha.php           # –°—Ç—Ä–∞–Ω–∏—Ü–∞ —Å –∫–∞–ø—á–µ–π
‚îú‚îÄ‚îÄ verify_captcha.php    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ check_captcha.php     # –§—É–Ω–∫—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏
‚îú‚îÄ‚îÄ clear_captcha_session.php # –û—á–∏—Å—Ç–∫–∞ —Å–µ—Å—Å–∏–∏
‚îî‚îÄ‚îÄ test_captcha_system.php  # –¢–µ—Å—Ç–æ–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞

üìÅ –ó–∞—â–∏—â–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:
‚îú‚îÄ‚îÄ miniapp.php           # –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ test_miniapp.php      # –¢–µ—Å—Ç–æ–≤–∞—è –≤–µ—Ä—Å–∏—è
‚îú‚îÄ‚îÄ check_user_api.php    # API –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îú‚îÄ‚îÄ get_affiliates_api.php # API —Å–ø–∏—Å–∫–∞ –ø–∞—Ä—Ç–Ω–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ register_api.php      # API —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

üìÅ –õ–æ–≥–∏ (—Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏):
‚îú‚îÄ‚îÄ logs/captcha_verifications.log # –£—Å–ø–µ—à–Ω—ã–µ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏  
‚îú‚îÄ‚îÄ logs/captcha_errors.log        # –û—à–∏–±–∫–∏
‚îî‚îÄ‚îÄ logs/captcha_actions.log       # –î–µ–π—Å—Ç–≤–∏—è (–æ—á–∏—Å—Ç–∫–∞ –∏ —Ç.–¥.)
```

## –í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### 1Ô∏è‚É£ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `miniapp.php` 
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –∫–∞–ø—á—É
- –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É
- –ü–æ–ø–∞–¥–∞–µ—Ç –Ω–∞ `miniapp.php`

### 2Ô∏è‚É£ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –¥–µ–π—Å—Ç–≤—É—é—â–µ–π –∫–∞–ø—á–µ–π  
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `miniapp.php`
- –°—Ä–∞–∑—É –≤–∏–¥–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–∫–∞–ø—á–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è)

### 3Ô∏è‚É£ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–π –∫–∞–ø—á–µ–π
- –ü–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ `miniapp.php`
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –Ω–∞ –Ω–æ–≤—É—é –∫–∞–ø—á—É
- –ü—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É –∑–∞–Ω–æ–≤–æ

## –ù–∞—Å—Ç—Ä–æ–π–∫–∏

### –í—Ä–µ–º—è –¥–µ–π—Å—Ç–≤–∏—è –∫–∞–ø—á–∏
–í `verify_captcha.php` –Ω–∞–π–¥–∏—Ç–µ:
```php
$_SESSION['captcha_expires'] = $currentTime + (30 * 60); // 30 –º–∏–Ω—É—Ç
```

### –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
–ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π—Ç–µ –≤ –Ω—É–∂–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö:
```php
// require_once 'check_captcha.php';
// requireCaptcha('miniapp');
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- üîí –ö–∞–ø—á–∞ –ø—Ä–∏–≤—è–∑–∞–Ω–∞ –∫ IP –∞–¥—Ä–µ—Å—É
- ‚è∞ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 30 –º–∏–Ω—É—Ç  
- üìù –í—Å–µ –¥–µ–π—Å—Ç–≤–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
- üö´ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
- üõ°Ô∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ CSRF

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

**–ö–∞–ø—á–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –ø–∞–ø–∫—É logs
chmod 755 logs/
```

**–ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- –û—á–∏—Å—Ç–∏—Ç–µ cookies –±—Ä–∞—É–∑–µ—Ä–∞
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É PHP —Å–µ—Å—Å–∏–π
- –û—Ç–∫—Ä–æ–π—Ç–µ `test_captcha_system.php` –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

**API –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 403:**
- –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–π–¥–∏—Ç–µ –∫–∞–ø—á—É –≤ –±—Ä–∞—É–∑–µ—Ä–µ
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Å–µ—Å—Å–∏–∏

## URL –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–µ–ª–µ–π

| –¶–µ–ª—å | URL |
|------|-----|
| –û–±—ã—á–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | `captcha.php?target=miniapp` |
| –¢–µ—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ | `captcha.php?target=test` |
| –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ | `test_captcha_system.php` |
| –ü—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ miniapp | `miniapp.php` (—Å –∞–≤—Ç–æ–ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º) |

---

**üí° –°–æ–≤–µ—Ç:** –ù–∞—á–Ω–∏—Ç–µ —Å –æ—Ç–∫—Ä—ã—Ç–∏—è `test_captcha_system.php` - —ç—Ç–æ –ø–æ–º–æ–∂–µ—Ç –ø–æ–Ω—è—Ç—å, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å–∏—Å—Ç–µ–º–∞! 

## üö® –ò—Å–ø—Ä–∞–≤–ª—è–µ–º –æ—à–∏–±–∫—É "–Ω–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á"!

–Ø –≤–∏–∂—É, —á—Ç–æ —É –≤–∞—Å –æ—à–∏–±–∫–∞ —Å –∫–ª—é—á–æ–º reCAPTCHA. –°–æ–∑–¥–∞–ª –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

### üõ†Ô∏è –î–∏–∞–≥–Ω–æ—Å—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞:
```
<code_block_to_apply_changes_from>
```

–≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø–æ–∫–∞–∂–µ—Ç:
- ‚úÖ –í–∞—à —Ç–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω –∏ –∫–ª—é—á–∏
- üîç –ü–æ—à–∞–≥–æ–≤—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é
- ‚ö° –ù–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ä–µ—à–µ–Ω–∏—è
- üìã –ß–µ–∫–ª–∏—Å—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏

### üéØ –°–∞–º–∞—è —á–∞—Å—Ç–∞—è –ø—Ä–∏—á–∏–Ω–∞:
**–î–æ–º–µ–Ω –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω –≤ Google reCAPTCHA Console**

### ‚ö° –ë—ã—Å—Ç—Ä–æ–µ —Ä–µ—à–µ–Ω–∏–µ:

1. **–ò–¥–∏—Ç–µ –Ω–∞** https://www.google.com/recaptcha/admin
2. **–ù–∞–π–¥–∏—Ç–µ –≤–∞—à —Å–∞–π—Ç** –≤ —Å–ø–∏—Å–∫–µ
3. **–í —Ä–∞–∑–¥–µ–ª–µ "–î–æ–º–µ–Ω—ã" –¥–æ–±–∞–≤—å—Ç–µ:**
   - –í–∞—à —Ç–µ–∫—É—â–∏–π –¥–æ–º–µ–Ω
   - `localhost` (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   - `127.0.0.1` (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
4. **–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è**

### üîß –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ —Ä–µ—à–µ–Ω–∏—è:

**–í