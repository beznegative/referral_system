-- =====================================================
-- SQL-запрос для phpMyAdmin
-- Изменение поля bank_card в таблице users - делаем его необязательным
-- =====================================================

-- 1. Изменяем структуру поля bank_card, делаем его необязательным (NULL)
ALTER TABLE `users` 
MODIFY COLUMN `bank_card` TEXT NULL DEFAULT NULL
COMMENT 'Зашифрованный номер банковской карты (необязательное поле)';

-- 2. Проверяем обновленную структуру таблицы (необязательно, для контроля)
-- DESCRIBE users;

-- 3. Устанавливаем NULL для существующих пустых записей (если есть)
UPDATE `users` 
SET `bank_card` = NULL 
WHERE `bank_card` = '' OR LENGTH(TRIM(`bank_card`)) = 0;

-- =====================================================
-- Информация об изменениях:
-- =====================================================
-- * Поле bank_card теперь может быть NULL
-- * Удалено ограничение NOT NULL
-- * Установлено значение по умолчанию NULL
-- * Очищены существующие пустые строки

-- Для проверки, что изменения применились:
-- SELECT COUNT(*) as total_users, 
--        COUNT(bank_card) as users_with_card,
--        COUNT(*) - COUNT(bank_card) as users_without_card
-- FROM users; 